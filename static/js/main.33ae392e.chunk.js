(this.webpackJsonpspritemaker=this.webpackJsonpspritemaker||[]).push([[0],[,,,,,function(e,t,a){e.exports={Tools:"Tools_Tools__2ZYfY",Tool:"Tools_Tool__3-sZp",Icon:"Tools_Icon__2qn5A",Active:"Tools_Active__2AX5m",Special:"Tools_Special__3sl6a",ColorPicker:"Tools_ColorPicker__2inf-",Undoable:"Tools_Undoable__3x95j",Disabled:"Tools_Disabled__1d70h"}},function(e,t,a){e.exports={TopBar:"TopBar_TopBar__1_vlW",MenuItem:"TopBar_MenuItem__1pCHd",SubMenu:"TopBar_SubMenu__3Q45P",SubMenuItem:"TopBar_SubMenuItem__JI3Pc",Label:"TopBar_Label__3taPn",Alt:"TopBar_Alt__GKwd_",Disabled:"TopBar_Disabled__3NYd8",SubMenuFileBrowserItem:"TopBar_SubMenuFileBrowserItem__IoW2T",Open:"TopBar_Open__ZmvHQ"}},function(e,t,a){e.exports={Layout:"Layout_Layout__3SBgk",Tools:"Layout_Tools__2P-C9",Main:"Layout_Main__2zCf8",Layers:"Layout_Layers__28ELP"}},function(e,t,a){e.exports={Canvas:"Canvas_Canvas__1VPYJ",Painting:"Canvas_Painting__MTXxZ",Filling:"Canvas_Filling__qc5Hk",Selecting:"Canvas_Selecting__gRcHX",Sampling:"Canvas_Sampling__1Rdgc"}},,,,,,,,,,,function(e,t,a){e.exports={CanvasController:"CanvasController_CanvasController__2EeQ0",Buttons:"CanvasController_Buttons__1Fp6i"}},function(e,t,a){e.exports={Preview:"Preview_Preview__2YDmj"}},function(e,t,a){e.exports=a(30)},,,,,function(e,t,a){},function(e,t,a){},,,function(e,t,a){"use strict";a.r(t);var n,o,l=a(1),c=a.n(l),r=a(15),i=a.n(r),s=(a(26),a(27),a(5)),u=a.n(s),d=a(11),f=a.n(d),E=a(18),v=a(17),h=a(13),p=a(16),_=a(4),O=a(2),m=a(3);!function(e){e[e.PAINT=0]="PAINT",e[e.FILL=1]="FILL",e[e.SELECT=2]="SELECT",e[e.SAMPLE=3]="SAMPLE"}(n||(n={})),function(e){e[e.NEW_FILE=0]="NEW_FILE",e[e.IMPORT_FILE=1]="IMPORT_FILE",e[e.EXPORT_FILE=2]="EXPORT_FILE",e[e.SET_CELL=3]="SET_CELL",e[e.FLOOD_FILL=4]="FLOOD_FILL",e[e.SET_SELECTION=5]="SET_SELECTION",e[e.FILL_SELECTION=6]="FILL_SELECTION",e[e.SAMPLE_CELL=7]="SAMPLE_CELL",e[e.ADD_HISTORY=8]="ADD_HISTORY",e[e.UNDO_HISTORY=9]="UNDO_HISTORY",e[e.REDO_HISTORY=10]="REDO_HISTORY",e[e.SELECT_TOOL=11]="SELECT_TOOL",e[e.CHANGE_COLOR=12]="CHANGE_COLOR",e[e.SET_PREVIEW_CANVAS=13]="SET_PREVIEW_CANVAS"}(o||(o={}));var b={width:16,height:16,undoStack:[],redoStack:[],cells:Object(m.a)(Array(256).fill("#ffffff")),previousTool:null,selectedTool:n.PAINT,activeColor:"#000000",selection:null,previewCanvas:null},T=Object(l.createContext)({state:b,dispatch:function(e){e.type,e.payload}}),L=function(e,t){var a=t.type,l=t.payload;switch(a){case o.NEW_FILE:return window.confirm("You will lose all unsaved changes if you do this. This is not undoable. Continue?")?Object(O.a)({},b):e;case o.EXPORT_FILE:var c,r,i=l.fileType,s=document.createElement("a");if("png"===i){var u;if(!(r=null===(u=e.previewCanvas)||void 0===u?void 0:u.toDataURL("image/png")))return alert("Unable to convert "),e;s.href=r,s.setAttribute("download","my_save.png")}else r=e.cells.map((function(e){return e.substring(1,2)+e.substring(3,4)+e.substring(5,6)})).join("\n"),s.href="data:,"+encodeURIComponent(r),s.setAttribute("download","my_save.dat");return s.click(),null===(c=s.parentNode)||void 0===c||c.removeChild(s),e;case o.IMPORT_FILE:var d=l.split("\n");if(d.length!==e.width*e.height)return alert("Wrong number of lines: received ".concat(d.length,", expected: ").concat(e.width*e.height)),e;var f=d.map((function(e){return["#",e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)].join("")}));return Object(O.a)(Object(O.a)({},e),{},{cells:f});case o.SET_CELL:var E=l.x,v=l.y,h=l.color,p=Object(m.a)(e.cells);return p[v*e.width+E]=h,Object(O.a)(Object(O.a)({},e),{},{cells:p});case o.FLOOD_FILL:var _=l.x,T=l.y,L=l.color,S=e.cells[T*e.width+_],y=Object(m.a)(e.cells);if(S===L)return e;return function t(a,n,o,l){a<0||a>=e.width||n<0||n>=e.height||e.cells[n*e.width+a]!==o||y[n*e.width+a]===l||(y[n*e.width+a]=l,t(a,n+1,o,l),t(a-1,n,o,l),t(a+1,n,o,l),t(a,n-1,o,l))}(_,T,S,L),Object(O.a)(Object(O.a)({},e),{},{cells:y});case o.SET_SELECTION:return Object(O.a)(Object(O.a)({},e),{},{selection:l});case o.FILL_SELECTION:if(!e.selection)return e;for(var C=Object(m.a)(e.cells),g=e.selection.y;g<=e.selection.y+e.selection.height;g++)for(var I=e.selection.x;I<=e.selection.x+e.selection.width;I++){C[g*e.width+I]=e.activeColor}return Object(O.a)(Object(O.a)({},e),{},{cells:C});case o.ADD_HISTORY:var w=[].concat(Object(m.a)(e.undoStack),[Object(m.a)(e.cells)]);return w.length>20&&w.shift(),Object(O.a)(Object(O.a)({},e),{},{undoStack:w,redoStack:[]});case o.UNDO_HISTORY:if(0===e.undoStack.length)return e;var j=[Object(m.a)(e.cells)].concat(Object(m.a)(e.redoStack)),k=Object(m.a)(e.undoStack),N=k.pop()||Object(m.a)(Array(e.width*e.height).fill("#ffffff"));return Object(O.a)(Object(O.a)({},e),{},{cells:Object(m.a)(N),undoStack:k,redoStack:j});case o.REDO_HISTORY:if(0===e.redoStack.length)return e;var A=Object(m.a)(e.redoStack),R=[].concat(Object(m.a)(e.undoStack),[Object(m.a)(e.cells)]),P=A.shift()||Object(m.a)(Array(e.width*e.height).fill("#ffffff"));return Object(O.a)(Object(O.a)({},e),{},{cells:Object(m.a)(P),undoStack:R,redoStack:A});case o.SAMPLE_CELL:var x=l.x,M=l.y,F=e.cells[M*e.width+x];return Object(O.a)(Object(O.a)({},e),{},{activeColor:F,selectedTool:e.previousTool||n.PAINT,previousTool:null});case o.SELECT_TOOL:return Object(O.a)(Object(O.a)({},e),{},{previousTool:e.selectedTool,selectedTool:l});case o.CHANGE_COLOR:return Object(O.a)(Object(O.a)({},e),{},{activeColor:l});case o.SET_PREVIEW_CANVAS:return Object(O.a)(Object(O.a)({},e),{},{previewCanvas:l});default:return e}},S=function(e){var t=e.children,a=Object(l.useReducer)(L,b),n=Object(_.a)(a,2),o=n[0],r=n[1];return c.a.createElement(T.Provider,{value:{state:o,dispatch:r}},t)},y=[{type:n.PAINT,icon:h.a},{type:n.FILL,icon:p.a},{type:n.SELECT,icon:v.a},{type:n.SAMPLE,icon:E.a}],C=function(e){var t=e.id,a=e.active,n=e.Icon,o=e.clicked;return c.a.createElement("div",{key:t,className:[u.a.Tool,a?u.a.Active:null].join(" "),onClick:o},c.a.createElement(n,{className:u.a.Icon}))},g=function(){var e=Object(l.useContext)(T),t=e.state,a=e.dispatch,n=Object(l.useCallback)(f.a.throttle((function(e){a({type:o.CHANGE_COLOR,payload:e.target.value})}),25,{leading:!0,trailing:!1}),[]),r=y.map((function(e,n){return c.a.createElement(C,{id:n,active:t.selectedTool===n,Icon:e.icon,key:n,clicked:function(){return t=e.type,a({type:o.SELECT_TOOL,payload:t});var t}})}));return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:u.a.Tools},r),c.a.createElement("div",{className:u.a.Special},c.a.createElement("p",null,t.activeColor),c.a.createElement("input",{className:u.a.ColorPicker,type:"color",value:t.activeColor,onChange:function(e){e.persist(),n(e)}}),c.a.createElement("div",{className:u.a.Undoable},c.a.createElement(h.c,{className:t.undoStack.length>0?"":u.a.Disabled,onClick:function(){return a({type:o.UNDO_HISTORY,payload:null})}}),c.a.createElement(h.b,{className:t.redoStack.length>0?"":u.a.Disabled,onClick:function(){return a({type:o.REDO_HISTORY,payload:null})}}))))},I=a(7),w=a.n(I),j=a(19),k=a.n(j),N=a(10),A=a.n(N),R=a(8),P=a.n(R),x=function(e){var t=e.mouseDown,a=e.mouseUp,o=e.drag,r=Object(l.createRef)(),i=Object(l.useState)(null),s=Object(_.a)(i,2),u=s[0],d=s[1],f=Object(l.useState)({x:512,y:512}),E=Object(_.a)(f,2),v=E[0],h=E[1],p=Object(l.useState)(32),O=Object(_.a)(p,2),m=O[0],b=O[1],L=Object(l.useState)(!1),S=Object(_.a)(L,2),y=S[0],C=S[1],g=Object(l.useContext)(T).state;Object(l.useEffect)((function(){var e;r&&d((null===(e=r.current)||void 0===e?void 0:e.getContext("2d"))||null)}),[r]),Object(l.useEffect)((function(){var e=function(){return C(!1)};y?document.addEventListener("click",e):document.removeEventListener("click",e)}),[y]),Object(l.useEffect)((function(){g.width>g.height?(h({x:512,y:Math.round(g.height/g.width*512)}),b(512/g.width)):g.height>g.width?(h({x:Math.round(g.width/g.height*512),y:512}),b(512/g.height)):(h({x:512,y:512}),b(512/g.width))}),[g.width,g.height]),Object(l.useEffect)((function(){if(u){u.fillStyle="#000000",u.fillRect(0,0,v.x,v.y);for(var e=0;e<g.height;e++)for(var t=0;t<g.width;t++)u.fillStyle=g.cells[e*g.width+t],u.fillRect(t*m,e*m,m-1,m-1);null!=g.selection&&(u.lineWidth=5,u.fillStyle="#0000ff88",u.fillRect(g.selection.x*m-1,g.selection.y*m-1,(g.selection.width+1)*m+1,(g.selection.height+1)*m+1),u.lineWidth=1),u.strokeStyle="#333333";for(var a=1;a<g.width;a++)u.moveTo(m*a,0),u.lineTo(m*a,v.y),u.stroke();for(var n=1;n<g.height;n++)u.moveTo(0,m*n),u.lineTo(v.x,m*n),u.stroke()}}),[u,m,v,g.width,g.height,g.cells,g.selection]);return c.a.createElement("canvas",{className:A()(P.a.Canvas,g.selectedTool===n.SELECT&&P.a.Selecting,g.selectedTool===n.FILL&&P.a.Filling,g.selectedTool===n.PAINT&&P.a.Painting,g.selectedTool===n.SAMPLE&&P.a.Sampling),ref:r,width:v.x,height:v.y,onMouseMove:function(e){if(y){var t=0+e.nativeEvent.offsetX,a=0+e.nativeEvent.offsetY,n=Math.floor(t/m),l=Math.floor(a/m);o(n,l)}},onMouseDown:function(e){var a=0+e.nativeEvent.offsetX,n=0+e.nativeEvent.offsetY,o=Math.floor(a/m),l=Math.floor(n/m);t(o,l),C(!0)},onMouseUp:function(e){var t=0+e.nativeEvent.offsetX,n=0+e.nativeEvent.offsetY,o=Math.floor(t/m),l=Math.floor(n/m);a(o,l),C(!1)}})},M=function(){var e=Object(l.useContext)(T),t=e.state,a=e.dispatch,r=Object(l.useState)({x:0,y:0}),i=Object(_.a)(r,2),s=i[0],u=i[1],f=function(e,n,l){e<0||e>=t.width||n<0||n>=t.height||t.cells[n*t.width+e]!==l&&a({type:o.SET_CELL,payload:{x:e,y:n,color:t.activeColor}})},E=function(){return a({type:o.ADD_HISTORY,payload:null})},v=Object(l.useCallback)(d.throttle((function(e,t){return function(e,t){var n=Math.min(s.x,e),l=Math.max(s.x,e),c=Math.min(s.y,t),r=Math.max(s.y,t);a({type:o.SET_SELECTION,payload:{x:n,y:c,width:l-n,height:r-c}})}(e,t)}),100),[s]),h=function(e,a){return!!t.selection&&(e>=t.selection.x&&e<=t.selection.x+t.selection.width&&a>=t.selection.y&&a<=t.selection.y+t.selection.height)};return c.a.createElement("div",{className:k.a.CanvasController},c.a.createElement(x,{mouseDown:function(e,l){switch(t.selectedTool){case n.PAINT:E(),f(e,l,t.activeColor);break;case n.FILL:E(),h(e,l)?a({type:o.FILL_SELECTION,payload:null}):a({type:o.FLOOD_FILL,payload:{x:e,y:l,color:t.activeColor}});break;case n.SAMPLE:a({type:o.SAMPLE_CELL,payload:{x:e,y:l}});break;case n.SELECT:u({x:e,y:l})}a({type:o.SET_SELECTION,payload:null})},mouseUp:function(e,t){},drag:function(e,a){t.selectedTool===n.PAINT?f(e,a,t.activeColor):t.selectedTool===n.SELECT&&v(e,a)}}))},F=a(20),D=a.n(F),Y=function(){var e=Object(l.useContext)(T),t=e.state,a=e.dispatch,n=Object(l.useRef)(null),r=Object(l.useState)(),i=Object(_.a)(r,2),s=i[0],u=i[1];return Object(l.useEffect)((function(){var e;n&&(u((null===(e=n.current)||void 0===e?void 0:e.getContext("2d"))||void 0),a({type:o.SET_PREVIEW_CANVAS,payload:n.current}))}),[n,a]),Object(l.useEffect)((function(){if(s)for(var e=64/t.width,a=0;a<t.height;a++)for(var n=0;n<t.width;n++)s.fillStyle=t.cells[a*t.width+n],s.fillRect(n*e,a*e,e,e)}),[n,s,t.width,t.height,t.cells]),c.a.createElement("div",{className:D.a.Preview},c.a.createElement("p",null,"Preview"),c.a.createElement("canvas",{width:"64",height:"64",ref:n}))},H=function(){return c.a.createElement("div",{className:w.a.Layout},c.a.createElement("div",{className:w.a.Tools},c.a.createElement(g,null),c.a.createElement(Y,null)),c.a.createElement("div",{className:w.a.Main},c.a.createElement(M,null),c.a.createElement("div",{className:w.a.Frames})),c.a.createElement("div",{className:w.a.Layers}))},B=a(6),W=a.n(B),U=function(e){var t=e.dispatch;return c.a.createElement("div",{className:W.a.SubMenuFileBrowserItem},c.a.createElement("input",{type:"file",onChange:function(e){var a;if(0!==(null===(a=e.target.files)||void 0===a?void 0:a.length)){var n=new FileReader;n.readAsText(e.target.files[0]),n.onload=function(){t({type:o.IMPORT_FILE,payload:n.result})},n.onerror=function(e){return console.error(e)}}},value:""}),c.a.createElement("label",null,"Import"))},X=function(e){var t=e.label,a=e.alt,n=e.onClick,o=e.disabled;return c.a.createElement("div",{className:A()(W.a.SubMenuItem,o&&W.a.Disabled),onClick:n},c.a.createElement("span",{className:W.a.Label},t),c.a.createElement("span",{className:W.a.Alt},a))},V=function(e){var t=e.label,a=e.isOpen,n=e.open,o=e.children;return c.a.createElement("div",{className:W.a.MenuItem},c.a.createElement("label",{onClick:n},t),c.a.createElement("div",{className:A()(W.a.SubMenu,a&&W.a.Open)},o))},G=function(){var e=Object(l.useState)(null),t=Object(_.a)(e,2),a=t[0],n=t[1],r=Object(l.useContext)(T),i=r.state,s=r.dispatch,u=function(){return n(null)};return Object(l.useEffect)((function(){return null!==a?document.addEventListener("click",u):document.removeEventListener("click",u),function(){return document.removeEventListener("click",u)}}),[a]),c.a.createElement("div",{className:W.a.TopBar},c.a.createElement(V,{label:"File",open:function(){return n(1)},isOpen:1===a},c.a.createElement(X,{label:"New File",onClick:function(){return s({type:o.NEW_FILE,payload:null})}}),c.a.createElement(U,{dispatch:s}),c.a.createElement(X,{label:"Export as PNG",onClick:function(){s({type:o.EXPORT_FILE,payload:{fileType:"png"}})}}),c.a.createElement(X,{label:"Export as 541 BMP",onClick:function(){s({type:o.EXPORT_FILE,payload:{fileType:"bmp"}})}})),c.a.createElement(V,{label:"Edit",open:function(){return n(2)},isOpen:2===a},c.a.createElement(X,{label:"Undo",alt:"ctrl + z",onClick:function(){s({type:o.UNDO_HISTORY,payload:null})},disabled:0===i.undoStack.length}),c.a.createElement(X,{label:"Redo",alt:"ctrl + shift + z",onClick:function(){s({type:o.REDO_HISTORY,payload:null})},disabled:0===i.redoStack.length})))},Z=function(e){var t=e.children,a=Object(l.useContext)(T).dispatch,n=function(e){e.preventDefault(),e.ctrlKey&&"KeyZ"===e.code&&(e.shiftKey?a({type:o.REDO_HISTORY,payload:null}):a({type:o.UNDO_HISTORY,payload:null}))};return Object(l.useEffect)((function(){return document.addEventListener("keypress",n),function(){document.removeEventListener("keypress",n)}})),c.a.createElement(c.a.Fragment,null,t)};var J=function(){return c.a.createElement("div",null,c.a.createElement(S,null,c.a.createElement(Z,null,c.a.createElement("header",null,c.a.createElement(G,null)),c.a.createElement(H,null))))},K=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function z(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(J,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/spritemaker",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/spritemaker","/service-worker.js");K?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):z(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):z(t,e)}))}}()}],[[21,1,2]]]);
//# sourceMappingURL=main.33ae392e.chunk.js.map