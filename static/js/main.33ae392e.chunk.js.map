{"version":3,"sources":["containers/Tools/Tools.module.scss","components/TopBar/TopBar.module.scss","components/Layout/Layout.module.css","components/Canvas/Canvas.module.scss","containers/CanvasController/CanvasController.module.scss","components/Preview/Preview.module.css","context/canvasContext.tsx","containers/Tools/Tools.tsx","components/Canvas/Canvas.tsx","containers/CanvasController/CanvasController.tsx","components/Preview/Preview.tsx","components/Layout/Layout.tsx","components/TopBar/TopBar.tsx","containers/InputManager/InputManager.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["module","exports","ToolType","CanvasAction","defaultState","width","height","undoStack","redoStack","cells","Array","fill","previousTool","selectedTool","PAINT","activeColor","selection","previewCanvas","CanvasContext","createContext","state","dispatch","type","payload","canvasReducer","action","NEW_FILE","window","confirm","EXPORT_FILE","data","fileType","link","document","createElement","toDataURL","alert","href","setAttribute","map","cell","substring","join","encodeURIComponent","click","parentNode","removeChild","IMPORT_FILE","splitLines","split","length","newCells","line","charAt","SET_CELL","x","y","color","FLOOD_FILL","origColor","helper","SET_SELECTION","FILL_SELECTION","ADD_HISTORY","newUndoStack","shift","UNDO_HISTORY","newRedoStack","pop","REDO_HISTORY","SAMPLE_CELL","newColor","SELECT_TOOL","CHANGE_COLOR","SET_PREVIEW_CANVAS","CanvasProvider","children","useReducer","Provider","value","tools","icon","FaPaintBrush","FILL","RiPaintFill","SELECT","BiShapeSquare","SAMPLE","ImEyedropper","Tool","id","active","Icon","clicked","key","className","classes","Active","onClick","Tools","useContext","debouncedHandleColorChange","useCallback","_","throttle","e","target","leading","trailing","toolItems","tool","i","Fragment","Special","ColorPicker","onChange","persist","Undoable","Disabled","Canvas","mouseDown","mouseUp","drag","canv","createRef","useState","ctx","setCtx","dimensions","setDimensions","MAX_DIMENSION","cellWidth","setCellWidth","isMouseDown","setMouseDown","useEffect","current","getContext","undoMouseDown","addEventListener","removeEventListener","Math","round","fillStyle","fillRect","lineWidth","strokeStyle","moveTo","lineTo","stroke","classnames","Selecting","Filling","Painting","Sampling","ref","onMouseMove","nativeEvent","offsetX","offsetY","xCell","floor","yCell","onMouseDown","onMouseUp","CanvasController","mouseDownLocation","setMouseDownLocation","setCell","pushHistory","debounceHandleSelect","minX","min","maxX","max","minY","maxY","handleSelect","withinSelection","Preview","canvas","useRef","undefined","Layout","Main","Frames","Layers","SubMenuFileBrowserItem","files","reader","FileReader","readAsText","onload","result","onerror","console","error","SubMenuItem","label","alt","disabled","Label","Alt","MenuItem","isOpen","open","SubMenu","Open","TopBar","openItem","setOpenItem","closeOpenItem","InputManager","keydown","preventDefault","ctrlKey","code","shiftKey","App","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","catch","ReactDOM","render","StrictMode","getElementById","URL","process","origin","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.33ae392e.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"Tools\":\"Tools_Tools__2ZYfY\",\"Tool\":\"Tools_Tool__3-sZp\",\"Icon\":\"Tools_Icon__2qn5A\",\"Active\":\"Tools_Active__2AX5m\",\"Special\":\"Tools_Special__3sl6a\",\"ColorPicker\":\"Tools_ColorPicker__2inf-\",\"Undoable\":\"Tools_Undoable__3x95j\",\"Disabled\":\"Tools_Disabled__1d70h\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"TopBar\":\"TopBar_TopBar__1_vlW\",\"MenuItem\":\"TopBar_MenuItem__1pCHd\",\"SubMenu\":\"TopBar_SubMenu__3Q45P\",\"SubMenuItem\":\"TopBar_SubMenuItem__JI3Pc\",\"Label\":\"TopBar_Label__3taPn\",\"Alt\":\"TopBar_Alt__GKwd_\",\"Disabled\":\"TopBar_Disabled__3NYd8\",\"SubMenuFileBrowserItem\":\"TopBar_SubMenuFileBrowserItem__IoW2T\",\"Open\":\"TopBar_Open__ZmvHQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Layout\":\"Layout_Layout__3SBgk\",\"Tools\":\"Layout_Tools__2P-C9\",\"Main\":\"Layout_Main__2zCf8\",\"Layers\":\"Layout_Layers__28ELP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Canvas\":\"Canvas_Canvas__1VPYJ\",\"Painting\":\"Canvas_Painting__MTXxZ\",\"Filling\":\"Canvas_Filling__qc5Hk\",\"Selecting\":\"Canvas_Selecting__gRcHX\",\"Sampling\":\"Canvas_Sampling__1Rdgc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"CanvasController\":\"CanvasController_CanvasController__2EeQ0\",\"Buttons\":\"CanvasController_Buttons__1Fp6i\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"Preview\":\"Preview_Preview__2YDmj\"};","import React, { createContext, useReducer } from 'react';\n\nenum ToolType {\n    PAINT = 0,\n    FILL,\n    SELECT,\n    SAMPLE\n}\n\nenum CanvasAction {\n    NEW_FILE,\n    IMPORT_FILE,\n    EXPORT_FILE,\n    SET_CELL,\n    FLOOD_FILL,\n    SET_SELECTION,\n    FILL_SELECTION,\n    SAMPLE_CELL,\n    ADD_HISTORY,\n    UNDO_HISTORY,\n    REDO_HISTORY,\n    SELECT_TOOL,\n    CHANGE_COLOR,\n    SET_PREVIEW_CANVAS\n}\n\ninterface CanvasState {\n    width: number;\n    height: number;\n    undoStack: string[][];\n    redoStack: string[][];\n    cells: string[];\n    previousTool: ToolType | null;\n    selectedTool: ToolType;\n    activeColor: string;\n    selection: { x: number, y: number, width: number, height: number } | null,\n    previewCanvas: HTMLCanvasElement | null;\n}\n\nconst defaultState: CanvasState = { \n    width: 16,\n    height: 16,\n    undoStack: [],\n    redoStack: [],\n    cells: [...Array(16* 16).fill('#ffffff')],\n    previousTool: null,\n    selectedTool: ToolType.PAINT,\n    activeColor: '#000000',\n    selection: null,\n    previewCanvas: null\n};\n\nconst CanvasContext = createContext({\n    state: defaultState,\n    dispatch: ({ type, payload}: { type: CanvasAction, payload: any}) => {}\n});\n\nconst canvasReducer = (state: CanvasState, action: { type: CanvasAction, payload: any}) => {\n    const { type, payload } = action;\n    switch (type) {\n        case (CanvasAction.NEW_FILE): {\n            if(window.confirm(\"You will lose all unsaved changes if you do this. This is not undoable. Continue?\")) {\n                return {...defaultState};\n            }\n            return state;\n        }\n        case (CanvasAction.EXPORT_FILE): {\n            const { fileType } = payload;\n            const link = document.createElement('a');\n            let data;\n            if (fileType === 'png'){\n                data = state.previewCanvas?.toDataURL(\"image/png\");\n                if (!data) {\n                    alert(\"Unable to convert \")\n                    return state;\n                }\n                link.href = data;\n                link.setAttribute('download', \"my_save.png\");\n            } else {\n                data = state.cells.map(cell => {\n                    return cell.substring(1,2) + cell.substring(3,4) + cell.substring(5, 6);\n                }).join('\\n');\n                link.href='data:,' + encodeURIComponent(data);\n                link.setAttribute('download', \"my_save.dat\");\n            }\n            link.click();\n            link.parentNode?.removeChild(link);\n            return state;\n        }\n        case (CanvasAction.IMPORT_FILE): {\n            const splitLines = (payload as string)\n                                .split(\"\\n\");\n            if (splitLines.length !== state.width * state.height) {\n                alert(`Wrong number of lines: received ${splitLines.length}, expected: ${state.width * state.height}`);\n                return state;\n            }\n            const newCells = splitLines.map(line => ['#', line.charAt(0) + line.charAt(0) + line.charAt(1) + line.charAt(1) + line.charAt(2) + line.charAt(2)].join(''));\n            return {...state, cells: newCells};\n        }\n        case (CanvasAction.SET_CELL): {\n            const { x, y, color } = payload;\n            const newCells = [...state.cells];\n            newCells[y * state.width + x] = color;\n            return { ...state, cells: newCells };\n        }\n        case (CanvasAction.FLOOD_FILL): {\n            const { x, y, color } = payload;\n            const origColor = state.cells[y * state.width + x];\n            const newCells = [...state.cells];\n            if (origColor === color) return state;\n            const helper = (x: number, y: number, origColor: string, color: string) => {\n                if (x < 0 || x >= state.width || y < 0 || y >= state.height || state.cells[y * state.width + x] !== origColor || newCells[y * state.width + x] === color) return;\n                newCells[y * state.width + x] = color;\n                helper(x    , y + 1, origColor, color);\n                helper(x - 1, y    , origColor, color);\n                helper(x + 1, y    , origColor, color);\n                helper(x    , y - 1, origColor, color);\n            }\n            helper(x, y, origColor, color);\n            return { ...state, cells: newCells }\n        }\n        case (CanvasAction.SET_SELECTION): {\n            return {...state, selection: payload};\n        }\n        case (CanvasAction.FILL_SELECTION): {\n            if (!state.selection) return state;\n            let newCells = [...state.cells];\n            for (let y = state.selection.y; y <= state.selection.y + state.selection.height; y++) {\n                for (let x = state.selection.x; x <= state.selection.x + state.selection.width; x++) {\n                    let cellNo = y * state.width + x;\n                    newCells[cellNo] = state.activeColor\n                }\n            }\n            return {...state, cells: newCells};\n        }\n        case (CanvasAction.ADD_HISTORY): {\n            const newUndoStack = [...state.undoStack, [...state.cells]];\n            if (newUndoStack.length > 20) newUndoStack.shift();\n            return {...state, undoStack: newUndoStack, redoStack: []}\n        }\n        case (CanvasAction.UNDO_HISTORY): {\n            if(state.undoStack.length === 0) return state;\n            const newRedoStack = [[...state.cells], ...state.redoStack];\n            const newUndoStack = [...state.undoStack];\n            const newCells = newUndoStack.pop() || [...Array(state.width * state.height).fill('#ffffff')];\n            return {...state, cells: [...newCells], undoStack: newUndoStack, redoStack: newRedoStack};\n        }\n        case (CanvasAction.REDO_HISTORY): {\n            if(state.redoStack.length === 0) return state;\n            const newRedoStack = [...state.redoStack];\n            const newUndoStack = [...state.undoStack, [...state.cells]];\n            const newCells = newRedoStack.shift() || [...Array(state.width * state.height).fill('#ffffff')];\n            const newState = {...state, cells: [...newCells], undoStack: newUndoStack, redoStack: newRedoStack};\n            return newState;\n        }\n        case (CanvasAction.SAMPLE_CELL): {\n            const { x, y } = payload;\n            const newColor = state.cells[y * state.width + x]\n            return {...state, activeColor: newColor, selectedTool: state.previousTool || ToolType.PAINT, previousTool: null }\n        }\n        case (CanvasAction.SELECT_TOOL): {\n            return {...state, previousTool: state.selectedTool, selectedTool: payload}; \n        }\n        case (CanvasAction.CHANGE_COLOR): {\n            return {...state, activeColor: payload}\n        }\n        case (CanvasAction.SET_PREVIEW_CANVAS): {\n            return { ...state, previewCanvas: payload };\n        }\n        default: {\n            return state;\n        }\n    }\n}\n\nconst CanvasProvider = ({children}: {children: React.ReactNode}) => {\n    const [ state, dispatch ] = useReducer(canvasReducer, defaultState);\n    return (\n        <CanvasContext.Provider value={{state, dispatch}}>\n            {children}\n        </CanvasContext.Provider>\n    )\n}\n\nexport default CanvasProvider;\n\nexport { CanvasAction, ToolType, CanvasContext}","import React, { SyntheticEvent, useCallback, useContext } from 'react';\nimport classes from './Tools.module.scss';\n\nimport _ from 'lodash';\nimport { ImEyedropper } from 'react-icons/im';\nimport { BiShapeSquare } from 'react-icons/bi';\nimport { FaPaintBrush, FaRedo, FaUndo } from 'react-icons/fa';\nimport { RiPaintFill } from 'react-icons/ri';\nimport { IconType } from 'react-icons';\nimport { CanvasAction, CanvasContext, ToolType } from '../../context/canvasContext';\n\nconst tools = [\n    {\n        type: ToolType.PAINT,\n        icon: FaPaintBrush\n    },\n    {\n        type: ToolType.FILL,\n        icon: RiPaintFill   \n    },\n    {\n        type: ToolType.SELECT,\n        icon: BiShapeSquare\n    },\n    {\n        type: ToolType.SAMPLE,\n        icon: ImEyedropper\n    }];\n\nconst Tool = ({ id, active, Icon, clicked }: { id: number, active: boolean, Icon: IconType, clicked: any }) => {\n    return <div key={id} className={[classes.Tool, active ? classes.Active : null].join(' ')} onClick={clicked}><Icon className={classes.Icon} /></div>\n}\n\nexport const Tools = () => {\n    const { state, dispatch } = useContext(CanvasContext);\n    const handleColorChange = (e: SyntheticEvent) => {\n        e.persist();\n        debouncedHandleColorChange(e);\n    };\n    //Just a little bit of debouncing here reduces almost all lag when dragging\n    const debouncedHandleColorChange = useCallback(\n        _.throttle((e: SyntheticEvent) => {\n            dispatch({ type: CanvasAction.CHANGE_COLOR, payload: (e.target as any).value })\n        }, 25, { leading: true, trailing: false}),\n        []\n    );\n    \n    const selectTool = (type: ToolType) => dispatch({ type: CanvasAction.SELECT_TOOL, payload: type });\n    const toolItems = tools.map((tool, i) => <Tool id={i} active={state.selectedTool === i} Icon={tool.icon} key={i} clicked={() => selectTool(tool.type)} />)\n\n    return (\n        <React.Fragment>\n            <div className={classes.Tools}>\n                {toolItems}\n            </div>\n            <div className={classes.Special} >\n                <p>{state.activeColor}</p>\n                <input className={classes.ColorPicker} type=\"color\" value={state.activeColor} onChange={handleColorChange} />\n                <div className={classes.Undoable}>\n                    <FaUndo className={state.undoStack.length > 0 ? '': classes.Disabled} onClick={() => dispatch({type: CanvasAction.UNDO_HISTORY, payload: null})}/>\n                    <FaRedo className={state.redoStack.length > 0 ? '': classes.Disabled} onClick={() => dispatch({type: CanvasAction.REDO_HISTORY, payload: null})}/>\n                </div>\n            </div>\n        </React.Fragment>\n    )\n}","import React, { createRef, Ref, useContext, useEffect, useState } from 'react';\nimport classnames from 'classnames';\nimport classes from './Canvas.module.scss';\nimport { CanvasContext, ToolType } from '../../context/canvasContext';\n\nconst MAX_DIMENSION = 512;\n\nexport const Canvas = ({mouseDown, mouseUp, drag}: { mouseDown: (x:number, y: number) => void, mouseUp: (x: number, y: number) => void, drag: (x: number, y:number) => void }) => {\n    const canv: Ref<HTMLCanvasElement> = createRef();\n    const [ ctx, setCtx ] = useState<CanvasRenderingContext2D | null>(null);\n    const [ dimensions, setDimensions ] = useState({ x: MAX_DIMENSION, y: MAX_DIMENSION });\n\n    const [ cellWidth, setCellWidth ] = useState(MAX_DIMENSION / 16);\n    const [ isMouseDown, setMouseDown ] = useState(false);\n    const { state } = useContext(CanvasContext);\n\n    useEffect(() => {\n        if (canv) {\n            setCtx(canv.current?.getContext(\"2d\") || null);\n        }\n    }, [ canv ]);\n\n    useEffect(() => {\n       const undoMouseDown = () => setMouseDown(false);\n       if (isMouseDown) {\n           document.addEventListener(\"click\", undoMouseDown);\n       } else {\n           document.removeEventListener(\"click\", undoMouseDown);\n       }\n    }, [ isMouseDown ])\n\n    useEffect(() => {\n        if (state.width > state.height) {\n            setDimensions({x: MAX_DIMENSION, y: Math.round((state.height / state.width) * MAX_DIMENSION)});\n            setCellWidth(MAX_DIMENSION / state.width);\n        } else if (state.height > state.width) {\n            setDimensions({x: Math.round((state.width / state.height) * MAX_DIMENSION), y: MAX_DIMENSION});\n            setCellWidth(MAX_DIMENSION / state.height);\n        } else {\n            setDimensions({x: MAX_DIMENSION, y: MAX_DIMENSION});\n            setCellWidth(MAX_DIMENSION / state.width);\n        }\n    }, [state.width, state.height])\n\n    useEffect(() => {\n        if (!ctx) return;\n        ctx!.fillStyle = \"#000000\";\n        ctx.fillRect(0, 0, dimensions.x, dimensions.y);\n\n        for(let y = 0; y < state.height; y++) {\n            for (let x = 0; x < state.width; x++) {\n                ctx!.fillStyle = state.cells[y * state.width + x];\n                ctx!.fillRect(x * cellWidth, y * cellWidth, cellWidth - 1, cellWidth - 1);\n            }\n        }\n\n        // make selection\n        if (state.selection != null) {\n            ctx.lineWidth = 5;\n            ctx.fillStyle = \"#0000ff88\";\n            ctx.fillRect(state.selection.x * cellWidth - 1, state.selection.y * cellWidth - 1, (state.selection.width + 1) * cellWidth + 1, (state.selection.height + 1) * cellWidth + 1);\n            ctx.lineWidth = 1;\n        }\n\n        // Draw Border\n        ctx!.strokeStyle = \"#333333\";\n        for(let i = 1; i < state.width; i++) {\n            ctx!.moveTo(cellWidth * i, 0);\n            ctx!.lineTo(cellWidth * i, dimensions.y)\n            ctx.stroke();\n        }\n        for(let i = 1; i < state.height; i++) {\n            ctx!.moveTo(0, cellWidth * i);\n            ctx!.lineTo(dimensions.x, cellWidth * i);\n            ctx.stroke();\n        }\n\n    }, [ ctx, cellWidth, dimensions, state.width, state.height, state.cells, state.selection ])\n\n    const mouseDownHandler = (e: any) => {\n        const x: number = 0 + e.nativeEvent.offsetX;\n        const y: number = 0 + e.nativeEvent.offsetY;\n        const xCell = Math.floor(x / (cellWidth));\n        const yCell = Math.floor(y / (cellWidth));\n        mouseDown(xCell, yCell);\n        setMouseDown(true);\n    }\n    \n    const mouseUpHandler = (e: any) => {\n        const x: number = 0 + e.nativeEvent.offsetX;\n        const y: number = 0 + e.nativeEvent.offsetY;\n        const xCell = Math.floor(x / (cellWidth));\n        const yCell = Math.floor(y / (cellWidth));\n        mouseUp(xCell, yCell);\n        setMouseDown(false);\n    }\n\n    const dragHandler = (e: any) => {\n        if (!isMouseDown) return;\n\n        const x: number = 0 + e.nativeEvent.offsetX;\n        const y: number = 0 + e.nativeEvent.offsetY;\n        const xCell = Math.floor(x / (cellWidth));\n        const yCell = Math.floor(y / (cellWidth));\n\n        drag(xCell, yCell);\n    }\n\n    return (\n        (\n        <canvas\n            className={classnames(classes.Canvas,\n                state.selectedTool === ToolType.SELECT && classes.Selecting,\n                state.selectedTool === ToolType.FILL && classes.Filling,\n                state.selectedTool === ToolType.PAINT && classes.Painting,\n                state.selectedTool === ToolType.SAMPLE && classes.Sampling)}\n            ref={canv}\n            width={dimensions.x}\n            height={dimensions.y}\n            onMouseMove={dragHandler}\n            onMouseDown={mouseDownHandler}\n            onMouseUp={mouseUpHandler} />\n        )\n    )\n\n}","import React, { useCallback, useContext, useState } from 'react';\nimport classes from './CanvasController.module.scss';\n\nimport * as _ from 'lodash';\n\nimport { Canvas } from '../../components/Canvas/Canvas';\nimport { CanvasAction, CanvasContext, ToolType } from '../../context/canvasContext';\n\nexport const CanvasController = () => {\n    const { state, dispatch } = useContext(CanvasContext);\n    \n    const [ mouseDownLocation, setMouseDownLocation ] = useState({x: 0, y: 0});\n\n    const setCell = (x: number, y: number, color: string) => {\n        if (x < 0 || x >= state.width || y < 0 || y >= state.height) return;\n        if (state.cells[y * state.width + x] === color) return;\n        dispatch({type: CanvasAction.SET_CELL, payload: { x, y, color: state.activeColor }});\n    }\n\n    const pushHistory = () => dispatch({type: CanvasAction.ADD_HISTORY, payload: null});\n\n    const mouseDownHandler = (x: number, y:number) => {\n        switch (state.selectedTool) {\n            case (ToolType.PAINT): {\n                pushHistory();\n                setCell(x, y, state.activeColor);\n                break;\n            }\n            case (ToolType.FILL): {\n                pushHistory();\n                if (withinSelection(x, y)) dispatch({ type: CanvasAction.FILL_SELECTION, payload: null});\n                else dispatch({type: CanvasAction.FLOOD_FILL, payload: { x, y, color: state.activeColor}});\n                break;\n            }\n            case (ToolType.SAMPLE): {\n                dispatch({ type: CanvasAction.SAMPLE_CELL, payload: {x, y}});\n                break;\n            }\n            case (ToolType.SELECT): {\n                setMouseDownLocation({x, y});\n            }\n        }\n        dispatch({type: CanvasAction.SET_SELECTION, payload: null});\n    }\n\n    const dragHandler = (x: number, y: number) => {\n        if (state.selectedTool === ToolType.PAINT) {\n            setCell(x, y, state.activeColor);\n        } else if (state.selectedTool === ToolType.SELECT) {\n            debounceHandleSelect(x, y);\n        }\n    }\n\n    const handleSelect = (x: number, y: number) => {\n        const minX = Math.min(mouseDownLocation.x, x!);\n        const maxX = Math.max(mouseDownLocation.x, x!);\n        const minY = Math.min(mouseDownLocation.y, y!);\n        const maxY = Math.max(mouseDownLocation.y, y!);\n        dispatch({type: CanvasAction.SET_SELECTION, payload: {x: minX, y: minY, width: maxX - minX, height: maxY - minY}});\n    }\n\n    const debounceHandleSelect = useCallback(\n        _.throttle((x: number, y: number) => handleSelect(x, y), 100),\n        [mouseDownLocation]\n    )\n\n    const mouseUpHandler = (x?: number, y?: number) => {\n        \n    }\n\n    const withinSelection = (x: number, y: number) => {\n        if (!state.selection) return false;\n        return x >= state.selection.x && x <= state.selection.x + state.selection.width\n            && y >= state.selection.y && y <= state.selection.y + state.selection.height;\n    }\n\n    return (\n        <div className={classes.CanvasController}>\n            <Canvas \n                mouseDown={mouseDownHandler}\n                mouseUp={mouseUpHandler}\n                drag={dragHandler}/>\n        </div>\n    )\n}","import classes from './Preview.module.css';\nimport React, { useContext, useEffect, useRef, useState } from 'react';\nimport { CanvasAction, CanvasContext } from '../../context/canvasContext';\n\nexport const Preview = () => {\n    const { state, dispatch } = useContext(CanvasContext);\n    const canvas = useRef<HTMLCanvasElement>(null);\n    const [ ctx, setCtx ] = useState<CanvasRenderingContext2D>();\n\n    useEffect(() => {\n        if (canvas) {\n            setCtx(canvas.current?.getContext(\"2d\") || undefined);\n            dispatch({type: CanvasAction.SET_PREVIEW_CANVAS, payload: canvas.current});\n        }\n    }, [canvas, dispatch]);\n\n    useEffect(() => {\n        if (!ctx) return;\n        const cellWidth = 64 / state.width;\n        for(let y = 0; y < state.height; y++) {\n            for (let x = 0; x < state.width; x++) {\n                ctx!.fillStyle = state.cells[y * state.width + x];\n                ctx!.fillRect(x * cellWidth, y * cellWidth, cellWidth, cellWidth);\n            }\n        }\n    }, [canvas, ctx, state.width, state.height, state.cells]);\n\n    return (\n        <div className={classes.Preview}>\n            <p>Preview</p>\n            <canvas\n                width=\"64\"\n                height=\"64\"\n                ref={canvas}\n                />\n        </div>\n    )\n}","import React from 'react';\nimport { Tools } from '../../containers/Tools/Tools';\nimport classes from './Layout.module.css';\nimport { CanvasController } from '../../containers/CanvasController/CanvasController';\nimport { Preview } from '../Preview/Preview';\n\nexport const Layout = () => {\n    return (\n        <div className={classes.Layout}>\n\n            <div className={classes.Tools}>\n                <Tools />\n                <Preview />\n            </div>\n            <div className={classes.Main}>\n                <CanvasController />\n                <div className={classes.Frames}>\n                </div>\n            </div>\n            <div className={classes.Layers}>\n            </div>\n        </div>\n    )\n}","import classes from './TopBar.module.scss';\nimport React, { SyntheticEvent, useContext, useEffect, useState } from 'react';\n\nimport classnames from 'classnames';\nimport { CanvasAction, CanvasContext } from '../../context/canvasContext';\n\nconst SubMenuFileBrowserItem = ({dispatch}: {dispatch: any}) => {\n    const onFileChange = (e: SyntheticEvent) => { \n        if ((e.target as any).files?.length === 0) return;\n        let reader = new FileReader();\n        reader.readAsText((e.target as any).files[0]);\n        reader.onload = () => {\n            dispatch({type: CanvasAction.IMPORT_FILE, payload: reader.result});\n\n        }\n        reader.onerror = (e) => console.error(e);\n    }\n    return (\n        <div className={classes.SubMenuFileBrowserItem}>\n            <input type=\"file\" onChange={onFileChange} value=\"\"></input>\n            <label>Import</label>\n        </div>\n    )\n}\n\nconst SubMenuItem = ({ label, alt, onClick, disabled}: { label: string, alt?: string, onClick: any, disabled?: boolean}) => {\n    return (\n        <div className={classnames(classes.SubMenuItem, disabled && classes.Disabled)} onClick={onClick}>\n            <span className={classes.Label}>{label}</span>\n            <span className={classes.Alt}>{alt}</span>\n        </div>\n    );\n}\n\nconst MenuItem = ({label, isOpen, open, children}: {label: string, isOpen: boolean, open: any, children: React.ReactNode}) => {\n    return (\n        <div className={classes.MenuItem}>\n            <label onClick={open}>{label}</label>\n            <div className={classnames(classes.SubMenu, isOpen && classes.Open)}>\n                {children}\n            </div>\n        </div>\n    )\n}\n\nexport const TopBar = () => {\n    const [ openItem, setOpenItem ] = useState<number | null>(null);\n    const { state, dispatch } = useContext(CanvasContext);\n    const closeOpenItem = () => setOpenItem(null);\n    useEffect(() => {\n        \n        if (openItem !== null) {\n            document.addEventListener(\"click\", closeOpenItem);\n        } else {\n            document.removeEventListener(\"click\", closeOpenItem);\n        }\n\n        return () => document.removeEventListener(\"click\", closeOpenItem);\n    }, [openItem])\n\n    return (\n        <div className={classes.TopBar}>\n            <MenuItem label=\"File\" open={() => setOpenItem(1)}isOpen={openItem === 1}>\n                <SubMenuItem \n                    label=\"New File\" \n                    onClick={() => dispatch({type: CanvasAction.NEW_FILE, payload: null})} />\n                <SubMenuFileBrowserItem dispatch={dispatch}/>\n                <SubMenuItem label=\"Export as PNG\" onClick={() => {dispatch({type: CanvasAction.EXPORT_FILE, payload: { fileType: 'png' }})}} />\n                <SubMenuItem label=\"Export as 541 BMP\" onClick={() => {dispatch({type: CanvasAction.EXPORT_FILE, payload: { fileType: 'bmp'}})}} />\n            </MenuItem>\n            <MenuItem label=\"Edit\" open={() => setOpenItem(2)} isOpen={openItem === 2}>\n                <SubMenuItem\n                    label=\"Undo\"\n                    alt=\"ctrl + z\"\n                    onClick={() => {dispatch({ type: CanvasAction.UNDO_HISTORY, payload: null})}}\n                    disabled={state.undoStack.length === 0} />\n                <SubMenuItem\n                    label=\"Redo\"\n                    alt=\"ctrl + shift + z\"\n                    onClick={() => {dispatch({ type: CanvasAction.REDO_HISTORY, payload: null})}}\n                    disabled={state.redoStack.length === 0} />\n            </MenuItem>\n        </div>\n    )\n}","import React, { useContext, useEffect } from 'react';\nimport { CanvasAction, CanvasContext } from '../../context/canvasContext';\n\nexport const InputManager = ({children}: {children: React.ReactNode}) => {\n    const { dispatch } = useContext(CanvasContext);\n    const undoAction = () => dispatch({type: CanvasAction.UNDO_HISTORY, payload: null});\n    const redoAction = () => dispatch({type: CanvasAction.REDO_HISTORY, payload: null});\n\n    const keydown = (e: any) => {\n        e.preventDefault();\n\n        if (e.ctrlKey) {\n            if(e.code === \"KeyZ\") {\n                if (e.shiftKey) {\n                    redoAction();\n                } else {\n                    undoAction();\n                }\n            }\n        }\n        \n    }\n    \n    useEffect(() => {\n        document.addEventListener(\"keypress\", keydown);\n        return () => {\n            document.removeEventListener(\"keypress\", keydown)\n        }\n    });\n\n    return (\n        <React.Fragment>\n            {children}\n        </React.Fragment>\n    )\n}","import React from 'react';\nimport './App.scss';\nimport { Layout } from './components/Layout/Layout';\nimport { TopBar } from './components/TopBar/TopBar';\nimport { InputManager } from './containers/InputManager/InputManager';\nimport CanvasProvider from './context/canvasContext';\n\nfunction App() {\n    return (\n        <div>\n            <CanvasProvider>\n                <InputManager>\n                    <header>\n                        <TopBar />\n                    </header>\n                    <Layout />\n                </InputManager>\n            </CanvasProvider>\n        </div>\n    );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}